<div class="container">

  <div class="head">
    <div class="row border-bottom">
      <div class="col-lg-4">
        <h1><%= @question.title %></h1>
      </div>

      <div class="col-lg-2">
        <br>
        評価 <%= @score.count %> 件
      </div>

      <div class="col-lg-3 offset-3 text-center">
        <br>
        <%= @question.created_at.strftime("%Y/%m/%d %H:%M") %>
      </div>
    </div>
  </div>

    <div class="row card card-body bg-light p-5" id="content">
      <%= markdown(@question.content).html_safe %>
    </div>

    <div class="row border-bottom" id="note">
      <div class="col-lg-8">
        <%= @question.note %>
      </div>

      <div class="col-lg-2 offset-2">
        <% if @question.user_id == current_user.id %>
        <% else %>
          <% if @question.favorited_by?(current_user) %>
            <li>
              <%= link_to question_question_score_path(@question), method: :delete, remote: true do %>
                <%= @question.question_scores.count %> いいね
              <% end %>
            </li>
          <% else %>
            <li>
              <%= link_to question_question_score_path(@question), method: :post, remote: true do %>
                <%= @question.question_scores.count %> いいね
              <% end %>
            </li>
          <% end %>
        <% end %>
      </div>
    </div>


    <div class="row border-bottom" id="answer">
      <div class="col-lg-3">
        回答<%= @answers.count %> 件
      </div>
    </div><br>

    <% @answers.each do |answer| %>

          <div class="row">
            <div class="col-lg-1 text-center">

            <% answer_scores = AnswerScore.where(answer_id: answer.id) %>
              <% answer_score = AnswerScore.find_by(user_id: current_user.id, answer_id: answer.id) %>

              <% if answer.user_id == current_user.id then %>
                <br>
                <%= answer_scores.pluck(:answer_score).sum %><br>
                <br>

              <% elsif answer_score && answer_score.answer_score == 1 then %>
                <br><br>
                <%= answer_scores.pluck(:answer_score).sum %><br>
                <%= link_to down_question_answer_path(@question.id, answer.id),method: :post, remote: true do %>
                  <%= octicon("chevron-down", :height => 48) %>
                <% end %>

              <% elsif answer_score && answer_score.answer_score == -1 then %>
                <%= link_to up_question_answer_path(@question.id, answer.id),method: :post, remote: true do %>
                  <%= octicon("chevron-up", :height => 48) %><br>
                <% end %>
                <%= answer_scores.pluck(:answer_score).sum %><br>
                <br><br>

              <% else %>
                <%= link_to up_question_answer_path(@question.id, answer.id),method: :post, remote: true do %>
                  <%= octicon("chevron-up", :height => 48, style:"color:blue;") %><br>
                <% end %>

                <%= answer_scores.pluck(:answer_score).sum %><br>

                <%= link_to down_question_answer_path(@question.id, answer.id),method: :post, remote: true do %>
                  <%= octicon("chevron-down", :height => 48) %>
                <% end %>

              <% end %>

            </div>
            <div class="col-lg-10 card card-body bg-light">
              <%= markdown(answer.answer_content).html_safe %>
            </div>
          </div><br>

          <div class="row">
            <% user = User.find(answer.user_id ) %>

            <div class="col-lg-1 offset-lg-9">
              <%= attachment_image_tag user,:profile_image, size:"50x50", fallback: "no_image.jpg", class:"rounded-circle" %>
            </div><br>

            <div class="col-lg-2">
            <%= link_to user_path(user.id) do %>
               <%= user.name %><br>
            <% end %>
                <strong>score </strong><%= user.score %><br>
            </div>
          </div><br>
          <div class="row border-bottom"></div><br>

    <% end %>




    <%= form_with model:@answer, url:question_answers_path(@question.id) do |form| %>
      <%= form.text_area :answer_content,  placeholde:"ここに回答を書いてください\nMarkdownm記法が使えます。" %>
      <%= form.submit "回答" %>
    <% end %>











<style>
  .head,  .error, #try, #content {
    margin-bottom: 50px;
  }
  #note {
    margin-bottom: 100px;
  }

</style>
